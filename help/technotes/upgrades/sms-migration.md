---
title: 移至新的SMS聯結器v2
description: 瞭解如何改用新的簡訊聯結器v2
feature: Technote
role: Admin
exl-id: 61a5a3e8-59f8-47ea-afc9-66ec243b8265
source-git-commit: ed9e784c1610a6f042b99223ac0d4cc0cf312b09
workflow-type: tm+mt
source-wordcount: '796'
ht-degree: 0%

---

# 移至新的SMS聯結器v2

本檔案概述從MTA型SMS聯結器移轉至Adobe Campaign v8中的新&#x200B;**專用SMS程式聯結器**&#x200B;時的程式和關鍵考量事項。

## 為何切換至v2聯結器

專用的SMS流程引入對SMPP收發器模式的支援，減少連線計數並提高資源效率，同時仍然在需要時支援傳送器/接收器設定。 它提供大幅提升的穩定性，可更快速地從錯誤中復原、持續連線，並且不依賴本機檔案或處理序間通訊。 效能也得到改善，延遲時間更短，吞吐量更高，智慧型微批次處理可平衡速度和可靠性。 此外，SMS程式的隔離可簡化疑難排解，並將跨頻道影響降至最低。 這些增強功能讓專用聯結器成為SMS傳送的更強大且可擴展的解決方案。

## v1和v2聯結器的差異

與MTA型聯結器相比，Adobe Campaign v8中的專用SMS聯結器引入了幾項架構變更。 一個關鍵差異是SMPP收發器模式的預設使用，其透過結合傳送和接收功能來減少連線數量。 如果提供者不支援此模式，仍可以使用個別的傳送器和接收器連線。 與MTA聯結器不同，啟用自動回覆對連線計數沒有影響，並且所有接收者連線都可以處理任何型別的傳入訊息。

連線計數現在使用不同的公式計算：

```
Total connections = SMS sending threads * Number of MTA child connections. 
```

在serverConf中定義的sendingThreads引數預設為1，通常應保持不變，除非特別針對高效能最佳化。 由於單一處理程式可處理所有SMS流量，因此透過這些引數管理平行性對於控制系統載入和行為至關重要。

傳送視窗的行為類似於MTA聯結器，但在專用模式下對效能的影響更大。 較大的傳送視窗可減少資料庫IOPS並改善輸送量。 Campaign可有效處理超過1000則訊息的視窗，前提是提供者支援此功能，且使用案例在發生連線問題時允許少量訊息遺失或重複。 在提供者端，設定較大的SR傳送視窗也可大幅改善傳送報表輸送量。

最後，雖然MO （行動原始）訊息處理的功能維持不變，但基礎程式碼已更新。 每個連線的輸送量仍以相同方式受限，但專用聯結器可大幅加快高載傳送速度。 但是，如果沒有輸送量限制，高速傳送可能會使提供者或系統資源不知所措，因此建議在外部帳戶設定中設定明確的MT輸送量上限。

## 切換程式

為確保順利切換至專用簡訊程式，最好在簡訊流量低或沒有簡訊流量時執行操作。 如果MTA緩衝區未完全清除，部分緩衝的訊息可能會遺失或處於無效狀態。 由於無法預測的SR時間，通常在切換後的一週內會遺漏某些SR。 即使內建了防護措施，未遵循這些預防措施仍可能導致訊息遺失或重複。

這兩個SMS聯結器都使用不同的格式進行SR （狀態報表）處理。 雖然兩者都依賴`NmsProviderMsgId`表格，但互動方式不同。 因此，切換聯結器需要清除整個表格，以防止衝突或孤立資料。 有幾種方法可以執行此清理。 以下是您可以使用的SQL查詢：

```
TRUNCATE TABLE NmsProviderMsgId;
TRUNCATE TABLE NmsProviderMsgStatus;
```

### 步驟

1. 檢閱`serverConf`設定(`sms > mta2`)。
1. 暫停即時訊息準備工作流程（如果適用）。
1. 暫停所有SMS傳遞。
1. 停用SMS外部帳戶。
1. 停止並重新啟動MTA和SMS程式。
1. 確認沒有作用中的SMPP連線。 如果有的話，請確認所有傳送都已暫停。
1. 清除資料庫中`NmsProviderMsgId`與`NmsProviderMsgStatus`資料表的內容。
1. 在外部帳戶中：
   * 啟用「專用流程」核取方塊
   * 調整其他設定：MTA子連線、MT輸送量、傳送視窗
1. 重新啟用外部帳戶並儲存。
1. 繼續SMS傳遞。
1. 檢查SMS服務是否正常運作。

>[!NOTE]
>
>監視SMS、MTA和MTA子記錄檔是否有錯誤或問題。
>
>儲存先前的外部帳戶設定以供回覆。

### 反轉程式

您可以依照初始切換期間使用的相同步驟，以相同順序復原至MTA聯結器。 這包括停止或暫停所有SMS傳遞，以及還原原始外部帳戶設定。

1. 如果執行個體使用即時傳遞，請暫停負責準備這些訊息的技術工作流程。
1. 暫停所有SMS傳遞。
1. 停用SMS外部帳戶。
1. 停止並重新啟動MTA和SMS程式。
1. 確認沒有作用中的SMPP連線；如果是，請確認所有傳送都已正確暫停。
1. 清除資料庫中的`NmsProviderMsgId`和`NmsProviderMsgStatus`資料表。
1. 在外部帳戶中：
   * 取消勾選外部帳戶中的「專用流程」選項。
   * 還原所有先前的外部帳戶設定： MTA子連線、MT輸送量、傳送視窗
1. 重新啟用並儲存外部帳戶。
1. 繼續所有SMS傳遞。
1. 最後，確認SMS服務正常運作。
